<!DOCTYPE html>
<html>
<head>
    <title>Table QR Codes Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .qr-card {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: white;
        }
        .qr-card img {
            width: 100%;
            max-width: 200px;
        }
        @media print {
            .no-print {display: none !important;}
            .qr-card {page-break-inside: avoid;}
        }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark no-print">
    <div class="container-fluid">
        <span class="navbar-brand">üì± Table QR Codes</span>
        <a href="my-store.html" class="btn btn-primary btn-sm">Back to My Store</a>
    </div>
</nav>

<div class="container mt-4">
    <div class="card p-4 mb-4 no-print">
        <h3>Generate Table QR Codes</h3>
        <p class="text-muted">Each table will get its own QR code. Customers scan it to order directly to their table.</p>
        
        <div class="row align-items-end">
            <div class="col-md-3">
                <label class="form-label">Number of Tables:</label>
                <input type="number" id="numTables" class="form-control" value="10" min="1" max="100">
            </div>
            <div class="col-md-3">
                <button onclick="generateQRCodes()" class="btn btn-success">
                    Generate QR Codes
                </button>
            </div>
            <div class="col-md-3">
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è Print All
                </button>
            </div>
            <div class="col-md-3">
                <button onclick="downloadAll()" class="btn btn-secondary">
                    ‚¨áÔ∏è Download All
                </button>
            </div>
        </div>
    </div>

    <div id="qrCodesContainer" class="qr-grid"></div>
</div>

<script src="script.js"></script>
<script>
let storeId = localStorage.getItem('currentStoreId')

if (!storeId) {
    alert('No store selected. Redirecting...')
    window.location.href = 'my-store.html'
}

function generateQRCodes() {
    const numTables = parseInt(document.getElementById('numTables').value)
    const container = document.getElementById('qrCodesContainer')
    container.innerHTML = ""

    const baseUrl = window.location.origin + `/static/menu.html?store=${storeId}`

    for (let i = 1; i <= numTables; i++) {
        const tableUrl = `${baseUrl}&table=${i}`
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(tableUrl)}`

        container.innerHTML += `
            <div class="qr-card">
                <h4>Table ${i}</h4>
                <img src="${qrUrl}" alt="Table ${i} QR Code">
                <div class="mt-3 no-print">
                    <button onclick="downloadQR('${qrUrl}', 'table-${i}-qr.png')" class="btn btn-sm btn-primary">
                        ‚¨áÔ∏è Download
                    </button>
                </div>
                <small class="text-muted d-block mt-2">Scan to order to Table ${i}</small>
            </div>
        `
    }
}

function downloadQR(url, filename) {
    const link = document.createElement('a')
    link.href = url
    link.download = filename
    link.click()
}

function downloadAll() {
    const numTables = parseInt(document.getElementById('numTables').value)
    const baseUrl = window.location.origin + `/static/menu.html?store=${storeId}`

    for (let i = 1; i <= numTables; i++) {
        setTimeout(() => {
            const tableUrl = `${baseUrl}&table=${i}`
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=800x800&data=${encodeURIComponent(tableUrl)}`
            downloadQR(qrUrl, `table-${i}-qr.png`)
        }, i * 200) // Stagger downloads
    }
}

// Generate initial QR codes
generateQRCodes()
</script>

</body>
</html>